<div class="layuimini-container layuimini-page-anim">
    <div class="layuimini-main">
        <form class="layui-form layui-form-pane" id="addHousing" action="">
            <!--房源信息-->
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>房源信息</legend>
            </fieldset>
            <!--标题-->
            <div class="layui-form-item">
                <label class="layui-form-label">房源标题</label>
                <div class="layui-input-block">
                    <input type="text" name="title" lay-verify="title" autocomplete="off" class="layui-input">
                </div>
            </div>
            <!--地址-->
            <div class="layui-form-item">
                <label class="layui-form-label">地址</label>
                <div class="layui-input-block">
                    <input type="text" disabled name="address" class="layui-input">
                </div>
            </div>
            <!--楼栋-->
            <div class="layui-form-item">
                <label class="layui-form-label">楼栋</label>
                <div class="layui-input-block">
                    <input type="text" disabled name="building" class="layui-input">
                </div>
            </div>
            <!--楼层-->
            <div class="layui-form-item">
                <label class="layui-form-label">楼层</label>
                <div class="layui-input-block">
                    <input type="text" name="floor" disabled class="layui-input">
                </div>
            </div>
            <!--户型-->
            <div class="layui-form-item layui-inline">
                <label class="layui-form-label">户型</label>
                <div class="layui-input-inline">
                    <input type="text" name="houseType_1"  lay-verify="required|number" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-form-mid">室</div>
                <div class="layui-input-inline">
                    <input type="text" name="houseType_2"  lay-verify="required|number" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-form-mid">厅&nbsp;&nbsp;&nbsp;&nbsp;</div>
                <div class="layui-input-inline">
                    <input type="text" name="houseType_3"  lay-verify="required|number" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-form-mid">卫</div>
                <div class="layui-input-inline">
                    <input type="text" name="houseType_4"  lay-verify="required|number" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-form-mid">厨</div>
                <div class="layui-input-inline">
                    <input type="text" name="houseType_5"  lay-verify="required|number" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-form-mid">阳台</div>
            </div>

            <!--面积-->
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">建筑面积</label>
                    <div class="layui-input-inline">
                        <input type="text" name="coveredArea" disabled class="layui-input">
                    </div>
                    <div class="layui-form-mid">平方米</div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">使用面积</label>
                    <div class="layui-input-inline">
                        <input type="text" name="useArea" lay-verify="required|number" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-form-mid">平方米</div>
                </div>
            </div>
            <!--朝向-->
            <div class="layui-form-item layui-inline">
                <label class="layui-form-label">朝向</label>
                <div class="layui-input-inline">
                    <input type="text" name="orientation" disabled class="layui-input">
                </div>
            </div>
            <!--装修-->
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">装修</label>
                    <div class="layui-input-inline">
                        <select name="decoration" lay-verify="required">
                            <option value="">请选择装修类型</option>
                            <option value="1">精装</option>
                            <option value="2">简装</option>
                            <option value="3">毛坯</option>
                        </select>
                    </div>
                </div>
            </div>
            <!--配套设施-->
            <div class="layui-form-item" pane="">
                <label class="layui-form-label">配套设施</label>
                <div class="layui-input-block">
                    <input type="checkbox" name="facilities_1" lay-skin="primary" title="水">
                    <input type="checkbox" name="facilities_2" lay-skin="primary" title="电">
                    <input type="checkbox" name="facilities_3" lay-skin="primary" title="煤气/天然气">
                    <input type="checkbox" name="facilities_4" lay-skin="primary" title="暖气/地暖">
                    <input type="checkbox" name="facilities_5" lay-skin="primary" title="有线电视">
                    <input type="checkbox" name="facilities_6" lay-skin="primary" title="宽带">
                    <input type="checkbox" name="facilities_7" lay-skin="primary" title="电梯">
                    <input type="checkbox" name="facilities_8" lay-skin="primary" title="车位/车库">
                    <input type="checkbox" name="facilities_9" lay-skin="primary" title="地下室/储藏室">
                </div>
            </div>
            <!--房源描述-->
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">房源描述</label>
                <div class="layui-input-block">
                    <textarea name="desc" placeholder="请勿填写联系方式或与房源信息以及图片、链接或品牌、优秀、顶级、全网首发、零距离、回报率等词汇。" class="layui-textarea"></textarea>
                </div>
            </div>

            <!--租赁信息-->
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
                <legend>租赁信息</legend>
            </fieldset>
            <div class="layui-form-item">
                <!--联系人-->
                <div class="layui-form-item layui-inline">
                    <label class="layui-form-label">联系人</label>
                    <div class="layui-input-block">
                        <input type="text" autocomplete name="contact" lay-verify="ZH" placeholder="请输入联系人" class="layui-input">
                    </div>
                </div>
                <!--联系方式-->
                <div class="layui-form-item layui-inline">
                    <div class="layui-inline">
                        <label class="layui-form-label">联系方式</label>
                        <div class="layui-input-inline">
                            <input type="tel" autocomplete placeholder="请输入联系方式" name="mobile" lay-verify="required|phone" class="layui-input">
                        </div>
                    </div>
                </div>
            </div>
            <!--租赁方式-->
            <div class="layui-form-item layui-inline">
                <label class="layui-form-label">租赁方式</label>
                <div class="layui-input-inline">
                    <select name="rentMethod" lay-verify="required">
                        <option value="">请选择租赁方式</option>
                        <option value="1">整租</option>
                        <option value="2">合租</option>
                    </select>
                </div>
            </div>
            <!--支付方式-->
            <div class="layui-form-item layui-inline">
                <label class="layui-form-label">支付方式</label>
                <div class="layui-input-inline">
                    <select name="paymentMethod" lay-verify="required">
                        <option value="">请选择支付方式</option>
                        <option value="1">付一押一</option>
                        <option value="2">付三押一</option>
                        <option value="3">付六押一</option>
                        <option value="4">年付押一</option>
                        <option value="5">其它</option>
                    </select>
                </div>
            </div>
            <!--看房时间-->
            <div class="layui-form-item layui-inline">
                <label class="layui-form-label">看房时间</label>
                <div class="layui-input-inline">
                    <select name="time" lay-verify="required">
                        <option value="">请选择看房时间</option>
                        <option value="1">上午</option>
                        <option value="2">中午</option>
                        <option value="3">下午</option>
                        <option value="4">晚上</option>
                        <option value="5">全天</option>
                    </select>
                </div>
            </div>
            <!--租金-->
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">租金</label>
                    <div class="layui-input-inline">
                        <input type="text" name="rent" lay-verify="required|number" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-form-mid">元/月</div>
                </div>
            </div>
            <!--物业费-->
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">物业费</label>
                    <div class="layui-input-inline">
                        <input type="text" name="propertyCost" lay-verify="required|number" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-form-mid">元/平</div>
                </div>
            </div>

            <!--提交-->
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" lay-submit="" lay-filter="demo1">立即提交</button>
                </div>
            </div>
        </form>
    </div>
</div>

<script src="lib/mods/base64.js"></script>
<script>
    layui.use(['form', 'table','miniPage','element'], function () {
        var $ = layui.jquery,
            form = layui.form,
            table = layui.table,
            miniPage = layui.miniPage;
        var data;
        var orientations = ["","南","东","北","西"];
        var rentMethods = ["","整租","合租"]
        var paymentMethods = ["","付一押一","付三押一","付六押一","年付押一","其它"];
        var times = ["","上午","中午","下午","晚上","全天"];


        /*初始化*/
        $(function () {
            data = eval('('+parent.json+')');

            //从父层获取值，json是父层的全局js变量。eval是将该string类型的json串变为标准的json串
            var houseType_1 = data.houseType.split("室")[0]
            var houseType_2 = data.houseType.split("室")[1].split("厅")[0]
            var houseType_3 = data.houseType.split("室")[1].split("厅")[1].split("卫")[0]
            var houseType_4 = data.houseType.split("室")[1].split("厅")[1].split("卫")[1].split("厨")[0]
            var houseType_5 = data.houseType.split("室")[1].split("厅")[1].split("卫")[1].split("厨")[1].split("阳台")[0]
            var facilities = data.facilities.split(",")

            $("[name='title']").eq(0).val(data.title)
            $("[name='address']").eq(0).val(Base64.utf8to16(Base64.decode64(data.estateId)))
            $("[name='building']").eq(0).val(data.buildingNum+"栋"+data.buildingUnit+"单元"+data.buildingFloorNum+"号")
            $("[name='floor']").eq(0).val("第"+data.floor.split("/")[0]+"层 | 总"+data.floor.split("/")[1]+"层")
            $("[name='houseType_1']").eq(0).val(houseType_1)
            $("[name='houseType_2']").eq(0).val(houseType_2)
            $("[name='houseType_3']").eq(0).val(houseType_3)
            $("[name='houseType_4']").eq(0).val(houseType_4)
            $("[name='houseType_5']").eq(0).val(houseType_5)
            $("[name='coveredArea']").eq(0).val(data.coveredArea)
            $("[name='useArea']").eq(0).val(data.useArea)
            $("[name='orientation']").eq(0).val(orientations[data.orientation.substring(0,1)])
            $("[name='decoration']").eq(0).val(data.decoration)
            facilities.forEach(function (item){
                if(item==1)
                    $("[name='facilities_1']").eq(0).attr("checked",true)
                if(item==2)
                    $("[name='facilities_2']").eq(0).attr("checked",true)
                if(item==3)
                    $("[name='facilities_3']").eq(0).attr("checked",true)
                if(item==4)
                    $("[name='facilities_4']").eq(0).attr("checked",true)
                if(item==5)
                    $("[name='facilities_5']").eq(0).attr("checked",true)
                if(item==6)
                    $("[name='facilities_6']").eq(0).attr("checked",true)
                if(item==7)
                    $("[name='facilities_7']").eq(0).attr("checked",true)
                if(item==8)
                    $("[name='facilities_8']").eq(0).attr("checked",true)
                if(item==9)
                    $("[name='facilities_9']").eq(0).attr("checked",true)
            });
            $("[name='desc']").eq(0).val(data.houseDesc)
            $("[name='rentMethod']").eq(0).val(data.rentMethod)
            $("[name='paymentMethod']").eq(0).val(data.paymentMethod)
            $("[name='time']").eq(0).val(data.time)
            $("[name='contact']").eq(0).val(data.contact)
            $("[name='mobile']").eq(0).val(data.mobile)
            $("[name='rent']").eq(0).val(data.rent)
            $("[name='propertyCost']").eq(0).val(data.propertyCost)


            form.render();  //更新渲染

        });

        //自定义验证规则
        form.verify({
            title: function (value) {
                if (value.length < 5) {
                    return '标题至少得5个字符啊';
                }
            },
            ZH:[
                /^[\u4e00-\u9fa5]{2,4}$/,
                '请输入中文姓名，超过4个字请简写'
            ]
        });

        //监听提交
        form.on('submit(demo1)', function (e) {
            var values = e.field
            console.log(values)
            var payload = {}

            //数据处理
            values.houseType = values.houseType_1  +"室"+ values.houseType_2  +"厅"+
                values.houseType_3 +"卫"+ values.houseType_4+"厨"+values.houseType_5+"阳台";
            values.facilities = ""
            for(let i = 1;i <= 9;++i){
                if(values["facilities_"+i]=="on"){
                    if(values.facilities=="")
                        values.facilities += i
                    else
                        values.facilities = values.facilities + "," + i;
                }
            }

            payload.id = data.id
            payload.title = values.title;
            payload.estateId = data.estateId;
            payload.buildingNum = data.buildingNum;
            payload.buildingUnit = data.buildingUnit;
            payload.buildingFloorNum = data.buildingFloorNum;
            payload.floor = data.floor;
            payload.houseType = values.houseType;
            payload.coveredArea = data.coveredArea;
            payload.useArea = values.useArea;
            payload.orientation = data.orientation;
            payload.decoration = values.decoration;
            payload.facilities = values.facilities;
            payload.houseDesc = values.desc;
            payload.rent = values.rent;
            payload.paymentMethod = values.paymentMethod;
            payload.rentMethod = values.rentMethod;
            payload.contact = values.contact;
            payload.mobile = values.mobile;
            payload.time = values.time;
            payload.propertyCost = values.propertyCost;
            payload.pic = data.pic
            console.log(payload)

            $.ajax({
                url:"http://localhost:9091/bg/house/resources",
                contentType:'application/json',
                type: "PUT",
                data:JSON.stringify(payload),
                success:function(res){
                    //墨绿深蓝风
                    layer.alert('提交成功', {
                        skin: 'layui-layer-lan',
                        closeBtn: 0
                    }, function(){
                        layer.closeAll();
                        window.location.reload();
                    });
                },
                error:function(err){
                    console.log(err)
                    layer.alert('提交失败', {
                        skin: 'layui-layer-lan',
                        closeBtn: 0
                    }, function(){
                        layer.closeAll();
                        window.location.reload()
                    });
                }
            })


            return false;
        });


    });
</script>

<!--
<script>
    layui.config({ base: 'js/' }).extend({
        multipleUpload: 'multipleUpload/multipleUpload'
    }).use(['form', 'multipleUpload'], function() {

        var $ = layui.$,
            form = layui.form,
            multipleUpload= layui.multipleUpload;

        var ins = multipleUpload.render({
            elem: '#test', // 你定义的容器id
            upload_url: 'http://localhost:9091/pic/upload', // 你的实际图片上传地址
            upload_choose:function (obj) {}, // 同upload choose回调，非必传
            upload_before:function (obj) {}, // 同upload before回调，非必传
            upload_error:function (index, upload) {}, // 同upload  error 回调，非必传
            upload_done: function (res, index, callback) { // 上传成功回调，必传，在处理自身的逻辑之后需要执行回调函数传入图片地址
                callback(res.name);
            },
            unshift: false, // 上传图片是否启用头部插入，默认是从图片列表尾部插入，添加按钮始终在头部，传true标识每次新增图片将会在添加按钮前面插入，添加按钮会后移
            hasDefaultBtn: true,// 是否需要默认按钮组，传入false不显示默认按钮组
            parseData: function(data) { // 处理data参数的格式的回调函数，data数据格式需要和上述例子相同，非必传
                var e = eval('('+parent.json+')');

                var pics = e.pic.split(",")
                for(let i = 0;i < pics.length;++i){
                    data.push({
                        index:i,
                            url:pics[i]
                    })
                }

                return data;
            }
        })

        var images = ins.getUploadImages(); //获取上传的图片数组
        var uploadIns = ins.getUploadInstance(); //获取upload上传实例![输入图片说明](https://images.gitee.com/uploads/images/2021/0108/175808_bd7518de_1476573.png "屏幕截图.png")
        console.log(images)
        console.log(uploadIns)
    });
</script>-->
